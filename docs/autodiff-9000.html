<html>

    <head>
        <link rel="stylesheet" href="stylesheet.css" />
    </head>

    <body>
        <div class="top-bar">
            <div class="top-text">
                <a href="index.html" class="ll">
                    <h1>
                        @everyone: <br> 
                        in a desperate quest to watch one punch man s2,
                        I've been banned from crunchyroll while using a
                        South-African vpn
                    </h1>
                    <p>
                    a blog about code, life, and poetry.
                    </p>
                </a>
            </div>
        </div>
        </div>
        <div class="middle">
            <div class="post">
                <h2 id="automatic-differentiator-9000">Automatic Differentiator
9000</h2>
<p>It almost feels like the easiest part of this program is the actual
differentiation. The rest is coming up with and writing the REPL, which
took several iterations and the most time.</p>
<p>Scheme's <code>read</code> procedure (which is a super buffed version
of your average <code>input()</code> or <code>cin</code> function) does
all the work for taking in user input.</p>
<h2 id="example">Example</h2>
<h3 id="differentiates-f-x-y-with-respect-to-x">differentiates (f x y)
with respect to x</h3>
<p><code>:f (f x y) = (* x y)</code><br />
<code>:d f x</code><br />
returns: <code>(df/dx x y) = (+ (* 1 y) (* x 0))</code><br />
<code>:e (df/dx 5 10)</code><br />
returns: <code>10</code></p>
<h2 id="math">Math</h2>
<p>The actual math part is recursively applying the following rules:</p>
<ul>
<li>When differentiating an arithmetic operation, we employ the product,
quotient, and distributivity over addition rules.</li>
<li>When differentiating a function, plug and chug its derivative using
<code>(deriv f)</code>, then use the chain rule.</li>
<li>If we're differentiating with respect to x, then
<code>d/dx[any-other-var]</code> is 0; that's the base case.</li>
</ul>
<p>Afterward, the evaluation command uses Scheme's <code>eval</code>
function to evaluate the derivative at some point. We get to do this
because the formula for the derivative is still lists and symbols (it
went from <code>(* x y)</code> to <code>(+ (* 1 y) (* x 0))</code>, and
is therefore valid Scheme code as long as x and y are defined. That is
one part of what makes Scheme so great; it's straightforward to jump
from abstract stuff (such as equations) to code.</p>
<h2 id="next-steps">Next Steps</h2>
<p>With these abstractions in place, calculating Hessian matrices,
discriminants, gradients, and company shouldn't be too difficult. I
believe all of this is also discussed in <a
href="https://mitpress.mit.edu/9780262546379/the-little-learner/">The
Little Learner</a>; I own a copy but have yet to read it...</p>
<h2 id="code-snippet">Code snippet</h2>
<p>The whole file can be found here: <a
href="https://github.com/konst-aa/fun/blob/main/autodiff.scm">good
times</a></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode scm"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">;; Accessors</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(x1 f)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">cadr</span> f))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(x2 f)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">caddr</span> f))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(rest f)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">cddr</span> f))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(deriv f)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">;; treat (x1 f) as x</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">case</span> (<span class="kw">car</span> f)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">expt</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>     `(<span class="op">*</span> ,(x2 f) (<span class="kw">expt</span> ,(x1 f) ,(<span class="op">-</span> (x2 f) <span class="dv">1</span>))))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">exp</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>     `(<span class="kw">exp</span> ,(x1 f)))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">sqrt</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>     (deriv `(<span class="kw">expt</span> ,(x1 f) <span class="fl">0.5</span>)))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">sin</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>     `(<span class="kw">cos</span> ,(x1 f)))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">cos</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>     `(<span class="op">-</span> (<span class="kw">sin</span> ,(x1 f))))))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(diff f wrt)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  (<span class="ex">define</span><span class="fu"> </span>(chain f g)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    `(<span class="op">*</span> ,(deriv f)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      ,(diff g wrt)))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">cond</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">eq?</span> wrt f) <span class="dv">1</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">and</span> (<span class="kw">pair?</span> f)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">null?</span> (<span class="kw">cddr</span> f))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">member</span> (<span class="kw">car</span> f) &#39;(<span class="op">*</span> <span class="op">+</span> <span class="op">/</span>)))</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>     (<span class="kw">case</span> (<span class="kw">car</span> f)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">+</span> <span class="op">*</span>)  <span class="co">; identity ops: (* x), (+ x), etc.</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        (diff (x1 f) wrt))</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">/</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        (diff `(<span class="op">/</span> <span class="dv">1</span> ,(x1 f)) wrt))))</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    ((<span class="kw">pair?</span> f)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>     (<span class="kw">case</span> (<span class="kw">car</span> f)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">+</span>) `(<span class="op">+</span> ,@(map (<span class="kw">lambda</span> (f) (diff f wrt)) (<span class="kw">cdr</span> f))))</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">-</span>) `(<span class="op">-</span> ,(diff `(<span class="op">+</span> ,@(<span class="kw">cdr</span> f)) wrt)))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">*</span>) `(<span class="op">+</span> (<span class="op">*</span> ,(diff (x1 f) wrt) ,@(rest f))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>              (<span class="op">*</span> ,(x1 f) ,(diff `(<span class="op">*</span> ,@(rest f)) wrt))))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>       ((<span class="op">/</span>) `(<span class="op">/</span> (<span class="op">-</span> (<span class="op">*</span> ,(diff (x1 f) wrt) ,(x2 f))</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                   (<span class="op">*</span> ,(x1 f) ,(diff (x2 f) wrt)))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>              (<span class="kw">expt</span> ,(x2 f) <span class="dv">2</span>)))</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">else</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>         <span class="co">;; does the heavy lifting</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>         (chain f (x1 f)))</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>       ))</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">else</span> <span class="dv">0</span>)))</span></code></pre></div>
<p><em>Posted on 03/29/2024</em></p>
<h2 id="more-from-programming">More from Programming:</h2>
<p><strong><a href="autodiff-9000.html">Automatic Differentiator
9000</a></strong><br />
<em>Posted on 03/29/2024</em></p>
<p>A somewhat short program (~150 loc) to automatically differentiate
s-exprs, along with a breakdown of how it works. It also comes with a
REPL ...</p>
<p><strong><a href="linear-equation-solver-9000.html">Linear Equation
Solver 9000</a></strong><br />
<em>Posted on 08/31/2023</em></p>
<p>A short program to solve linear equations using gaussian elimination,
along with a breakdown of how it works.<br />
...</p>
<h2 id="more-from-math">More from Math:</h2>
            </div>
            <div class="sidebar">
                <h2>
                    About me
                </h2>
                <p>
                I'm Konstantin Astafurov, a Daedalus Scholar at Hunter College who loves to code.
                </p>
                <p>
                You can find me in other places, some significantly less professional than others:
                <ul>
                    <li>
                        <p>
                        <a href="https://github.com/konst-aa" class="hll">Github</a>
                        </p>
                    </li>
                    <li>
                        <p>
                        <a href="https://www.facebook.com/konstantin.astafurov" class="hll">Facebook</a>
                        </p>
                    </li>
                    <li>
                        <p>
                        <a href="https://www.youtube.com/channel/UCHs2YFht8yKgjexuwLiXBNg" class="hll">Youtube</a>
                        </p>
                    </li>
                    <li>
                        <p>
                        <a href="mailto:konstantin.astafurov@gmail.com" class="hll">Email</a>
                        </p>
                    </li>
                    <li>
                        <p>
                        <a href="https://twitter.com/PyriteSpellbomb" class="hll">Twitter</a> (rarely active)
                        </p>
                    </li>
                </ul>
                </p>
                <p>
                Page layout heavily inspired by 
                <a href="https://prog21.dadgum.com/143.html" class="hll">programming in the twenty-first century</a>.
                </p>
                <p>
                Generated with my <a href="https://github.com/konstantin-aa/pal-blog-generator" class="hll">blog generator</a>.
                </p>
                <!-- <h2> -->
                <!--     Join the mailing list! -->
                <!-- </h2> -->
                <!-- <form id="subscribe-form"> -->
                <!--     <input type="text" name="email" id="subscribe-email" placeholder="your-email@example.com"> -->
                <!--     <button type="submit" value="subscribe" onclick="document.getElementById('unsubscribe-message').innerHTML = 'subscribed!'"> subscribe </button> -->
                <!--     <a id="unsubscribe-message"></a> -->
                <!-- </form> -->
                <!-- <script> -->
                <!--     let subscribeForm = document.getElementById("subscribe-form"); -->
                <!--     subscribeForm.addEventListener("submit", (e) => { -->
                <!--         e.preventDefault(); -->

                <!--         let email = document.getElementById("subscribe-email").value; -->
                <!--         var ImageObject = new Image(); -->
                <!--         // a minute amount of tomfoolery -->
                <!--         ImageObject.src = "https://ml.dreadmaw.industries/subscribe?email=" + email; -->
                <!--     }); -->
                <!-- </script> -->

                            </div>
        </div>
    </body>

</html>
